!function(){"use strict";const t="https://determined-painted-hawthorn.glitch.me/api",e=async e=>{const n=await fetch(t+e);return await n.json()},n=t=>{localStorage.setItem("cart",JSON.stringify(t))},c=()=>JSON.parse(localStorage.getItem("cart")),a=t=>"image/notimage.jpg"===t?"assets/images/no-photo.jpg":`https://determined-painted-hawthorn.glitch.me/${t}`,r=(t,e)=>Math.round(t*(100-e)/100),o=t=>{if(String(t).length>=4){const e=t%1e3,n=Math.trunc(t/1e3);return String(n)+" "+(String(e).padStart(3,"0")||"000")}return t},s=(t,e)=>t.findIndex((t=>t.id===e)),i=(t,e)=>{const n=document.createElement(t);return n.className=e,n},l=(t,e,n)=>{const c=i(t,e);return c.textContent=`-${n}%`,c},d=t=>{const e=i("li","sublist__item"),n=i("a","sublist__link");return n.textContent=t,e.append(n),n.href=`catalog.html?category=${t}`,e},_=(t,e)=>{const n=t.map((t=>(({id:t,price:e,title:n,image:c,discount:o,category:s})=>{const d=i("li","benefit__item card");d.dataset.name=t;const _=i("a","benefit__link"),u=`card.html?category=${s}&id=${t}`;_.href=u;const p=i("div","card-img__wrapper"),m=i("img","card__img");m.loading="lazy",m.width="420",m.height="295",m.src=a(c),p.append(m);const g=i("div","card__price"),y=i("span","card__sale-price");if(y.textContent=`${e} ₽`,o){const t=l("span","card__sale",o);p.append(t);const n=i("span","card__start-price");n.textContent=`${e} ₽`,y.textContent=r(e,o)+" ₽",g.append(y,n)}else g.append(y);const h=i("p","card__title");return h.textContent=n,_.append(p,g,h),d.append(_),d})(t))),c=i("ul","benefit__list");return c.append(...n),c},u=(t,e,n,c)=>{"-"===c&&(c=0);const a=o(e*c),s=o(r(e*c,n)),i=t.querySelector(".cart-list__price");i.innerHTML="",n?i.insertAdjacentHTML("afterbegin",`<p class="cart-list__priceFinal">${s} ₽</p>\n          <p class="cart-list__priceStart">${a} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `):i.insertAdjacentHTML("afterbegin",`          \n        <p class="cart-list__priceFinal">${a} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `)},p=t=>{const e=(c()||[]).reduce(((t,e)=>t+Number(e.count)),0)||"",n=document.querySelector(".btn-cart__count");e?(n.textContent=e,n.style.backgroundColor="#ffffff"):(n.textContent=e,n.style.backgroundColor="transparent"),t&&(document.querySelector(".cart__count").textContent=e,document.querySelector(".span__count").textContent=e)},m=()=>{const t=document.querySelector(".cart-list"),n=c()||[];n?n.forEach((async n=>{const c=`/goods/${n.id}`,r=await e(c),o=(({title:t,price:e,image:n,discount:c,category:a,id:r},o)=>{const s=i("li","cart-list__item");return s.dataset.name=r,s.insertAdjacentHTML("afterbegin",`\n      <div class="cart-list__wrap-input">\n        <input class="cart-list__input" type="checkbox" name="" id="">\n        <div class="cart-list__img">\n          <img  src=https://determined-painted-hawthorn.glitch.me/${n} alt="" >\n        </div>\n      </div>\n            \n      <div class="cart-list__info">\n        <div class="cart-list__content">\n          <a href="card.html?category=${a}&id=${r}" class="cart-list__title">${t}</a>\n          \n        </div>\n        <div class="cart-list__count-control count">\n          <buton class="count__btn count__btn_minus">−</buton>\n          <span class="count__text">${o}</span>\n          <buton class="count__btn count__btn_plus">+</buton>\n        </div>\n        <div class="cart-list__price">          \n        </div>\n      </div>      \n      <button class="cart-list__cart"></button>\n  `),u(s,e,c,o),s})(r,n.count);t.append(o);const s=document.querySelector(".delivery__info-img"),l=(({image:t,id:e})=>{const n=i("div","delivery__box-img");n.dataset.img=e;const c=i("img","delivery__img");return c.src=a(t),n.append(c),n})(r);s.append(l)})):console.log("В КОРЗИНЕ ПУСТО")},g=document.querySelector(".cart-list"),y=t=>t.closest(".cart-list__item"),h=(t,e)=>{if("plus"===e){const e=t.previousElementSibling,n=e.textContent;return e.textContent="-"===n?1:+n+1,e.textContent}if("minus"===e){const e=t.nextElementSibling,n=e.textContent;return e.textContent=n>=2?+n-1:0,e.textContent}},f=t=>t.dataset.name,b=async t=>{const n=`/goods/${t}`;return await e(n)},v=()=>{const t=c()||[];let e=0,n=0;t.forEach((({price:t,count:c,discount:a})=>{n+=t*c,e+=r(t,a)*c})),document.querySelector(".total__sumFinal").textContent=o(e)+" ₽",document.querySelector(".total__sumStart").textContent=o(n)+" ₽",document.querySelector(".total__sale").textContent=o(n-e)+" ₽"},S=t=>{const e=document.querySelectorAll(".delivery__box-img");Array.from(e).find((e=>e.dataset.img===t)).closest(".delivery__box-img").remove()},x=()=>{g.addEventListener("click",(async({target:t})=>{let e;if(t.classList.contains("count__btn_plus")){e=h(t,"plus");const a=y(t),r=f(a),o=await b(r);u(a,o.price,o.discount,e);const i=c();i[s(i,r)].count=+e,n(i),p("shop"),v()}else if(t.classList.contains("count__btn_minus")){e=h(t,"minus");const a=y(t),r=f(a),o=await b(r),i=c(),l=s(i,r);0==e?(a.remove(),i.splice(l,1),S(r)):(u(a,o.price,o.discount,e),i[l].count=+e),n(i),p("shop"),v()}})),v(),g.addEventListener("click",(({target:t})=>{if(t.classList.contains("cart-list__cart")){const e=y(t);if(e.querySelector(".cart-list__input").checked){const t=c(),a=f(e),r=s(t,a);t.splice(r,1),n(t),p("shop"),v(),e.remove(),S(a)}}})),document.querySelector(".cart__btn-deleteall").addEventListener("click",(()=>{Array.from(document.querySelectorAll(".cart-list__input")).filter((t=>t.checked)).forEach((t=>{const e=y(t),a=c(),r=f(e),o=s(a,r);a.splice(o,1),n(a),p("shop"),v(),e.remove(),S(r)}))})),(()=>{const t=document.querySelector(".cart__input-checkall");t.addEventListener("click",(()=>{const e=Array.from(document.querySelectorAll(".cart-list__input"));t.checked?e.forEach((t=>{t.checked=!0})):e.forEach((t=>t.checked=!1))}))})()};(()=>{const t=document.querySelectorAll(".nav__item_catalog .nav__title"),e=document.querySelectorAll(".nav__item_buyer .nav__title"),n=document.querySelectorAll(".sublist_catalog"),c=document.querySelectorAll(".sublist_buyer");t.forEach(((t,e)=>{t.addEventListener("click",(()=>{n[e].classList.toggle("sublist_show")}))})),e.forEach(((t,e)=>{t.addEventListener("click",(()=>{c[e].classList.toggle("sublist_show")}))}))})(),(()=>{const t=document.querySelector(".menu"),e=t.querySelector(".menu__img");t.addEventListener("click",(()=>{document.querySelector(".header-nav").classList.toggle("header-nav_active"),e.classList.toggle("menu__img-active")}))})(),(async()=>{const t=await e("/category"),n=document.querySelector(".header .sublist_catalog"),c=document.querySelector(".footer .sublist_catalog"),a=t.map((t=>d(t))),r=t.map((t=>d(t)));n.append(...a),c.append(...r)})(),p("shop"),m(),x(),(async()=>{const t=(await e("/goods/")).filter((t=>t.discount)),n=i("h1","catalog__title");n.textContent="Это выгодно!";const c=_(t),a=document.querySelector(".benefit__container");a.innerHTML="",a.append(n,c)})()}();