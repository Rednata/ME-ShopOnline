!function(){"use strict";const t="https://determined-painted-hawthorn.glitch.me/api",e=async e=>{const n=await fetch(t+e);return await n.json()},n=t=>{localStorage.setItem("cart",JSON.stringify(t))},c=()=>JSON.parse(localStorage.getItem("cart")),r=(t,e)=>Math.round(t*(100-e)/100),a=t=>{if(String(t).length>=4){const e=t%1e3,n=Math.trunc(t/1e3);return String(n)+" "+(String(e).padStart(3,"0")||"000")}return t},s=(t,e)=>t.findIndex((t=>t.id===e)),o=(t,e)=>{const n=document.createElement(t);return n.className=e,n},i=(t,e,n)=>{const c=o(t,e);return c.textContent=`-${n}%`,c},l=t=>{const e=o("li","sublist__item"),n=o("a","sublist__link");return n.textContent=t,e.append(n),n.href=`catalog.html?category=${t}`,e},d=(t,e)=>{const n=t.map((t=>(({id:t,price:e,title:n,image:c,discount:a,category:s})=>{const l=o("li","benefit__item card");l.dataset.name=t;const d=o("a","benefit__link"),_=`card.html?category=${s}&id=${t}`;d.href=_;const u=o("div","card-img__wrapper"),p=o("img","card__img");p.loading="lazy",p.width="420",p.height="295",p.src=`https://determined-painted-hawthorn.glitch.me/${c}`,p.addEventListener("error",(()=>{p.src="assets/images/no-photo.jpg"})),u.append(p);const m=o("div","card__price"),g=o("span","card__sale-price");if(g.textContent=`${e} ₽`,a){const t=i("span","card__sale",a);u.append(t);const n=o("span","card__start-price");n.textContent=`${e} ₽`,g.textContent=r(e,a)+" ₽",m.append(g,n)}else m.append(g);const h=o("p","card__title");return h.textContent=n,d.append(u,m,h),l.append(d),l})(t))),c=o("ul","benefit__list");return c.append(...n),c},_=(t,e,n,c)=>{"-"===c&&(c=0);const s=a(e*c),o=a(r(e*c,n)),i=t.querySelector(".cart-list__price");i.innerHTML="",n?i.insertAdjacentHTML("afterbegin",`<p class="cart-list__priceFinal">${o} ₽</p>\n          <p class="cart-list__priceStart">${s} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `):i.insertAdjacentHTML("afterbegin",`          \n        <p class="cart-list__priceFinal">${s} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `)},u=t=>{const e=(c()||[]).reduce(((t,e)=>t+Number(e.count)),0)||"",n=document.querySelector(".btn-cart__count");e?(n.textContent=e,n.style.backgroundColor="#ffffff"):(n.textContent=e,n.style.backgroundColor="transparent"),t&&(document.querySelector(".cart__count").textContent=e,document.querySelector(".span__count").textContent=e)},p=()=>{const t=document.querySelector(".cart-list"),n=c()||[];n?n.forEach((async n=>{const c=`/goods/${n.id}`,r=await e(c),a=(({title:t,price:e,image:n,discount:c,category:r,id:a},s)=>{const i=o("li","cart-list__item");return i.dataset.name=a,i.insertAdjacentHTML("afterbegin",`\n      <div class="cart-list__wrap-input">\n        <input class="cart-list__input" type="checkbox" name="" id="">\n        <div class="cart-list__img">\n          <img  src=https://determined-painted-hawthorn.glitch.me/${n} alt="" >\n        </div>\n      </div>\n            \n      <div class="cart-list__info">\n        <div class="cart-list__content">\n          <a href="card.html?category=${r}&id=${a}" class="cart-list__title">${t}</a>\n          \n        </div>\n        <div class="cart-list__count-control count">\n          <buton class="count__btn count__btn_minus">−</buton>\n          <span class="count__text">${s}</span>\n          <buton class="count__btn count__btn_plus">+</buton>\n        </div>\n        <div class="cart-list__price">          \n        </div>\n      </div>      \n      <button class="cart-list__cart"></button>\n  `),_(i,e,c,s),i})(r,n.count);t.append(a);const s=document.querySelector(".delivery__info-img"),i=(({image:t,id:e})=>{const n=o("div","delivery__box-img");n.dataset.img=e;const c=o("img","delivery__img");return c.src=`https://determined-painted-hawthorn.glitch.me/${t}`,c.addEventListener("error",(()=>{c.src="assets/images/no-photo.jpg"})),n.append(c),n})(r);s.append(i)})):console.log("В КОРЗИНЕ ПУСТО")},m=document.querySelector(".cart-list"),g=t=>t.closest(".cart-list__item"),h=(t,e)=>{if("plus"===e){const e=t.previousElementSibling,n=e.textContent;return e.textContent="-"===n?1:+n+1,e.textContent}if("minus"===e){const e=t.nextElementSibling,n=e.textContent;return e.textContent=n>=2?+n-1:0,e.textContent}},y=t=>t.dataset.name,f=async t=>{const n=`/goods/${t}`;return await e(n)},v=()=>{const t=c()||[];let e=0,n=0;t.forEach((({price:t,count:c,discount:a})=>{n+=t*c,e+=r(t,a)*c})),document.querySelector(".total__sumFinal").textContent=a(e)+" ₽",document.querySelector(".total__sumStart").textContent=a(n)+" ₽",document.querySelector(".total__sale").textContent=a(n-e)+" ₽"},b=t=>{const e=document.querySelectorAll(".delivery__box-img");Array.from(e).find((e=>e.dataset.img===t)).closest(".delivery__box-img").remove()},S=()=>{m.addEventListener("click",(async({target:t})=>{let e;if(t.classList.contains("count__btn_plus")){e=h(t,"plus");const r=g(t),a=y(r),o=await f(a);_(r,o.price,o.discount,e);const i=c();i[s(i,a)].count=+e,n(i),u("shop"),v()}else if(t.classList.contains("count__btn_minus")){e=h(t,"minus");const r=g(t),a=y(r),o=await f(a),i=c(),l=s(i,a);0==e?(r.remove(),i.splice(l,1),b(a)):(_(r,o.price,o.discount,e),i[l].count=+e),n(i),u("shop"),v()}})),v(),m.addEventListener("click",(({target:t})=>{if(t.classList.contains("cart-list__cart")){const e=g(t);if(e.querySelector(".cart-list__input").checked){const t=c(),r=y(e),a=s(t,r);t.splice(a,1),n(t),u("shop"),v(),e.remove(),b(r)}}})),document.querySelector(".cart__btn-deleteall").addEventListener("click",(()=>{Array.from(document.querySelectorAll(".cart-list__input")).filter((t=>t.checked)).forEach((t=>{const e=g(t),r=c(),a=y(e),o=s(r,a);r.splice(o,1),n(r),u("shop"),v(),e.remove(),b(a)}))})),(()=>{const t=document.querySelector(".cart__input-checkall");t.addEventListener("click",(()=>{const e=Array.from(document.querySelectorAll(".cart-list__input"));t.checked?e.forEach((t=>{t.checked=!0})):e.forEach((t=>t.checked=!1))}))})()};(()=>{const t=document.querySelectorAll(".nav__item_catalog .nav__title"),e=document.querySelectorAll(".nav__item_buyer .nav__title"),n=document.querySelectorAll(".sublist_catalog"),c=document.querySelectorAll(".sublist_buyer");t.forEach(((t,e)=>{t.addEventListener("click",(()=>{n[e].classList.toggle("sublist_show")}))})),e.forEach(((t,e)=>{t.addEventListener("click",(()=>{c[e].classList.toggle("sublist_show")}))}))})(),(()=>{const t=document.querySelector(".menu"),e=t.querySelector(".menu__img");t.addEventListener("click",(()=>{document.querySelector(".header-nav").classList.toggle("header-nav_active"),e.classList.toggle("menu__img-active")}))})(),(async()=>{const t=await e("/category"),n=document.querySelector(".header .sublist_catalog"),c=document.querySelector(".footer .sublist_catalog"),r=t.map((t=>l(t))),a=t.map((t=>l(t)));n.append(...r),c.append(...a)})(),u("shop"),p(),S(),(async()=>{const t=(await e("/goods/")).filter((t=>t.discount)),n=o("h1","catalog__title");n.textContent="Это выгодно!";const c=d(t),r=document.querySelector(".benefit__container");r.innerHTML="",r.append(n,c)})()}();