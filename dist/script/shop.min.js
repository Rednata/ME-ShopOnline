!function(){"use strict";const t="https://determined-painted-hawthorn.glitch.me/api",e=async e=>{const n=await fetch(t+e);return await n.json()},n=t=>{localStorage.setItem("cart",JSON.stringify(t))},c=()=>JSON.parse(localStorage.getItem("cart")),s=(t,e)=>Math.round(t*(100-e)/100),o=t=>{if(String(t).length>=4){const e=t%1e3,n=Math.trunc(t/1e3);return String(n)+" "+(String(e).padStart(3,"0")||"000")}return t},r=(t,e)=>t.findIndex((t=>t.id===e)),a=(t,e)=>{const n=document.createElement(t);return n.className=e,n},i=t=>{const e=a("li","sublist__item"),n=a("a","sublist__link");return n.textContent=t,e.append(n),n.href=`catalog.html?category=${t}`,e},l=(t,e,n,c)=>{"-"===c&&(c=0);const r=o(e*c),a=o(s(e*c,n)),i=t.querySelector(".cart-list__price");i.innerHTML="",n?i.insertAdjacentHTML("afterbegin",`<p class="cart-list__priceFinal">${a} ₽</p>\n          <p class="cart-list__priceStart">${r} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `):i.insertAdjacentHTML("afterbegin",`          \n        <p class="cart-list__priceFinal">${r} ₽</p>\n          <p class="cart-list__credit">В кредит от 5600 ₽ </p>\n    `)},u=t=>{const e=(c()||[]).reduce(((t,e)=>t+Number(e.count)),0)||"",n=document.querySelector(".btn-cart__count");e?(n.textContent=e,n.style.backgroundColor="#ffffff"):(n.textContent=e,n.style.backgroundColor="transparent"),t&&(document.querySelector(".cart__count").textContent=e,document.querySelector(".span__count").textContent=e)},_=()=>{const t=document.querySelector(".cart-list"),n=c()||[];n?n.forEach((async n=>{const c=`/goods/${n.id}`,s=await e(c),o=(({title:t,price:e,image:n,discount:c,category:s,id:o},r)=>{const i=a("li","cart-list__item");return i.dataset.name=o,i.insertAdjacentHTML("afterbegin",`\n      <div class="cart-list__wrap-input">\n        <input class="cart-list__input" type="checkbox" name="" id="">\n        <div class="cart-list__img">\n          <img  src=https://determined-painted-hawthorn.glitch.me/${n} alt="" >\n        </div>\n      </div>\n            \n      <div class="cart-list__info">\n        <div class="cart-list__content">\n          <a href="card.html?category=${s}&id=${o}" class="cart-list__title">${t}</a>\n          \n        </div>\n        <div class="cart-list__count-control count">\n          <buton class="count__btn count__btn_minus">−</buton>\n          <span class="count__text">${r}</span>\n          <buton class="count__btn count__btn_plus">+</buton>\n        </div>\n        <div class="cart-list__price">          \n        </div>\n      </div>      \n      <button class="cart-list__cart"></button>\n  `),l(i,e,c,r),i})(s,n.count);t.append(o);const r=document.querySelector(".delivery__info-img"),i=(({image:t,id:e})=>{const n=a("div","delivery__box-img");n.dataset.img=e;const c=a("img","delivery__img");return c.src=(t=>"image/notimage.jpg"===t?"assets/images/no-photo.jpg":`https://determined-painted-hawthorn.glitch.me/${t}`)(t),n.append(c),n})(s);r.append(i)})):console.log("В КОРЗИНЕ ПУСТО")},d=document.querySelector(".cart-list"),m=t=>t.closest(".cart-list__item"),p=(t,e)=>{if("plus"===e){const e=t.previousElementSibling,n=e.textContent;return e.textContent="-"===n?1:+n+1,e.textContent}if("minus"===e){const e=t.nextElementSibling,n=e.textContent;return e.textContent=n>=2?+n-1:"-",e.textContent}},g=t=>t.dataset.name,y=async t=>{const n=`/goods/${t}`;return await e(n)},h=()=>{const t=c()||[];let e=0,n=0;t.forEach((({price:t,count:c,discount:o})=>{n+=t*c,e+=s(t,o)*c})),document.querySelector(".total__sumFinal").textContent=o(e)+" ₽",document.querySelector(".total__sumStart").textContent=o(n)+" ₽",document.querySelector(".total__sale").textContent=o(n-e)+" ₽"},f=t=>{const e=document.querySelectorAll(".delivery__box-img");Array.from(e).find((e=>e.dataset.img===t)).closest(".delivery__box-img").remove()},v=()=>{d.addEventListener("click",(async({target:t})=>{let e;if(t.classList.contains("count__btn_plus")){e=p(t,"plus");const s=m(t),o=g(s),a=await y(o);l(s,a.price,a.discount,e);const i=c();i[r(i,o)].count=+e,n(i),u("shop"),h()}else if(t.classList.contains("count__btn_minus")){e=p(t,"minus");const s=m(t),o=g(s),a=await y(o);l(s,a.price,a.discount,e);const i=c();i[r(i,o)].count=+e||0,n(i),u("shop"),h()}})),h(),d.addEventListener("click",(({target:t})=>{if(t.classList.contains("cart-list__cart")){const e=m(t);if(e.querySelector(".cart-list__input").checked){const t=c(),s=g(e),o=r(t,s);t.splice(o,1),n(t),u("shop"),h(),e.remove(),f(s)}}})),document.querySelector(".cart__btn-deleteall").addEventListener("click",(()=>{Array.from(document.querySelectorAll(".cart-list__input")).filter((t=>t.checked)).forEach((t=>{const e=m(t),s=c(),o=g(e),a=r(s,o);s.splice(a,1),n(s),u("shop"),h(),e.remove(),f(o)}))})),(()=>{const t=document.querySelector(".cart__input-checkall");t.addEventListener("click",(()=>{const e=Array.from(document.querySelectorAll(".cart-list__input"));t.checked?e.forEach((t=>{t.checked=!0})):e.forEach((t=>t.checked=!1))}))})()};(()=>{const t=document.querySelectorAll(".nav__item_catalog .nav__title"),e=document.querySelectorAll(".nav__item_buyer .nav__title"),n=document.querySelectorAll(".sublist_catalog"),c=document.querySelectorAll(".sublist_buyer");t.forEach(((t,e)=>{t.addEventListener("click",(()=>{n[e].classList.toggle("sublist_show")}))})),e.forEach(((t,e)=>{t.addEventListener("click",(()=>{c[e].classList.toggle("sublist_show")}))}))})(),(()=>{const t=document.querySelector(".menu"),e=t.querySelector(".menu__img");t.addEventListener("click",(()=>{document.querySelector(".header-nav").classList.toggle("header-nav_active"),e.classList.toggle("menu__img-active")}))})(),(async()=>{const t=await e("/category"),n=document.querySelector(".header .sublist_catalog"),c=document.querySelector(".footer .sublist_catalog"),s=t.map((t=>i(t))),o=t.map((t=>i(t)));n.append(...s),c.append(...o)})(),u("shop"),_(),v()}();